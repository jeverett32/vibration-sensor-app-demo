<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,500&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="152x152" href="images/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon-180x180.png">
  <link rel="apple-touch-icon" sizes="167x167" href="images/apple-touch-icon-167x167.png">
  <link href="css/new-styles.css" rel="stylesheet" type="text/css" />
  <title>Device Control - Vibration Sensor App</title>
</head>
<body>
  <script>
    if (localStorage.getItem('loggedIn') !== 'true') {
      window.location.href = 'index.html';
    }
  </script>
  <header class="app-header">
    <a href="dashboard.html" class="back-arrow"><i class="material-icons">arrow_back</i></a>
    <div class="title">Device Control</div>
  </header>
  <div class="container">
    <div class="card">
      <div class="card-title">Device Information</div>
      <div id="device-info">
        <div><strong>Last Synced:</strong> <span id="last-synced">Never</span></div>
      </div>
    </div>
    <div id="anomaly-summary" class="card" style="display: none;">
      <div class="card-title">Anomaly Summary</div>
      <p>Number of anomaly readings: 3</p>
      <p>Severity: High</p>
      <p>Time of last anomaly: 2025-11-17 10:30 AM</p>
    </div>
    <div class="card">
        <div style="display: flex; align-items: center; justify-content: space-between;">
            <button id="upload-btn" class="btn">Sync</button>
            <div id="device-status"></div>
        </div>
    </div>
  </div>
  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const device = urlParams.get('device');
    const deviceInfo = document.getElementById('device-info');
    const anomalySummary = document.getElementById('anomaly-summary');
    const deviceStatus = document.getElementById('device-status');
    const uploadBtn = document.getElementById('upload-btn');
    const lastSynced = document.getElementById('last-synced');

    // Simulate being in range of some devices
    const inRangeDevices = ['debarker', 'chipper'];

    if (inRangeDevices.includes(device)) {
        deviceStatus.innerHTML = '<span class="status-good">In Range</span>';
        uploadBtn.disabled = false;
    } else {
        deviceStatus.innerHTML = '<span class="status-problem">Out of Range</span>';
        uploadBtn.disabled = true;
    }

    if (device === 'debarker') {
      deviceInfo.innerHTML = `
        <div><strong>Device ID:</strong> DBI-002-VIB</div>
        <div><strong>Status:</strong> <span class="status-problem">Maintenance Recommended</span></div>
        <div><strong>Battery:</strong> <span class="status-problem">Replace</span></div>
        <div><strong>Last Synced:</strong> <span id="last-synced">2025-11-16 14:30</span></div>
      `;
      anomalySummary.style.display = 'block';
    } else if (device === 'chipper') {
        deviceInfo.innerHTML = `
        <div><strong>Device ID:</strong> CHP-003-VIB</div>
        <div><strong>Status:</strong> <span class="status-good">Good</span></div>
        <div><strong>Battery:</strong> <span class="status-good">Good</span></div>
        <div><strong>Last Synced:</strong> <span id="last-synced">2025-11-17 10:00</span></div>
      `;
    }
    else {
      deviceInfo.innerHTML = `
        <div><strong>Device ID:</strong> HRS-001-VIB</div>
        <div><strong>Status:</strong> <span class="status-good">Good</span></div>
        <div><strong>Battery:</strong> <span class="status-good">Good</span></div>
        <div><strong>Last Synced:</strong> <span id="last-synced">2025-11-17 11:45</span></div>
      `;
    }

    uploadBtn.addEventListener('click', function() {
        uploadBtn.disabled = true;
        uploadBtn.textContent = 'Syncing...';
        let width = 0;
        const interval = setInterval(function() {
            width += 10;
            uploadBtn.style.background = `linear-gradient(to right, #1976d2 ${width}%, #ccc ${width}%)`;
            if (width >= 100) {
                clearInterval(interval);
                setTimeout(function() {
                    uploadBtn.textContent = 'Synced';
                    uploadBtn.style.background = '#4CAF50';
                    lastSynced.textContent = new Date().toLocaleString();
                    setTimeout(function() {
                        uploadBtn.textContent = 'Sync';
                        uploadBtn.style.background = '#1976d2';
                        uploadBtn.disabled = false;
                    }, 2000);
                }, 500);
            }
        }, 100);
    });
  </script>
</body>
</html>